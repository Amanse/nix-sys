{ pkgs,... }:
{
  programs.waybar = {
    enable = true;
    style = builtins.readFile ./style.css;
    settings = {
      mainBar = {
        layer = "top"; # Waybar at top layer
        position = "top"; # Waybar position (top|bottom|left|right)
        height = 30; # Waybar height (to be removed for auto height)
        # width= 1280; // Waybar width
        spacing = 4; # Gaps between modules (4px)
        # Choose the order of the modules
        modules-left = [ "wlr/workspaces" "sway/workspaces" "sway/mode" "sway/scratchpad" "custom/media" ];
        modules-center = [ "hyprland/window" ];
        modules-right = [ "bluetooth" "pulseaudio" "network" "cpu" "memory" "temperature" "backlight" "keyboard-state" "battery" "battery#bat2" "clock" "tray" ];
        "hyprland/window" = {
          format = "üëâ {}";
          separate-outputs = true;
        };
        # Modules configuration
        "wlr/workspaces" = {
          "disable-scroll" = true;
          "all-outputs" = true;
          "format" = "{name}: {icon}";
          "format-icons" = {
            "1" = "ÔÑ†";
            "2" = "Ôâ®";
            "3" = "ÔÑ°";
            "4" = "ÔÜº";
            "5" = "ÔÅµ";
            "urgent" = "ÔÅ™";
            "focused" = "ÔÜí";
            "default" = "ÔÑë";
          };
        };
        "keyboard-state" = {
          "numlock" = true;
          "capslock" = true;
          "format" = "{name} {icon}";
          "format-icons" = {
            "locked" = "ÔÄ£";
            "unlocked" = "ÔÇú";
          };
        };
        "sway/mode" = {
          "format" = "<span style=\"italic\">{}</span>";
        };
        "sway/scratchpad" = {
          "format" = "{icon} {count}";
          "show-empty" = false;
          "format-icons" = [ "" "Ôãí" ];
          "tooltip" = true;
          "tooltip-format" = "{app}: {title}";
        };
        "mpd" = {
          "format" = "{stateIcon} {consumeIcon}{randomIcon}{repeatIcon}{singleIcon}{artist} - {album} - {title} ({elapsedTime:%M:%S}/{totalTime:%M:%S}) ‚∏®{songPosition}|{queueLength}‚∏© {volume}% ÔÄÅ";
          "format-disconnected" = "Disconnected ÔÄÅ";
          "format-stopped" = "{consumeIcon}{randomIcon}{repeatIcon}{singleIcon}Stopped ÔÄÅ";
          "unknown-tag" = "N/A";
          "interval" = 2;
          "consume-icons" = {
            "on" = "ÔÉÑ ";
          };
          "random-icons" = {
            "off" = "<span color=\"#f53c3c\">ÔÅ¥</span> ";
            "on" = "ÔÅ¥ ";
          };
          "repeat-icons" = {
            "on" = "ÔÄû ";
          };
          "single-icons" = {
            "on" = "ÔÄû1 ";
          };
          "state-icons" = {
            "paused" = "ÔÅå";
            "playing" = "ÔÅã";
          };
          "tooltip-format" = "MPD (connected)";
          "tooltip-format-disconnected" = "MPD (disconnected)";
        };
        "idle_inhibitor" = {
          "format" = "{icon}";
          "format-icons" = {
            "activated" = "ÔÅÆ";
            "deactivated" = "ÔÅ∞";
          };
        };
        "tray" = {
          # "icon-size"= 21;
          "spacing" = 10;
        };
        "clock" = {
          # "timezone"= "America/New_York";
          "format" = "{:%I:%M %p}";
          "tooltip-format" = "<big>{:%Y %B}</big>\n<tt><small>{calendar}</small></tt>";
          "format-alt" = "{:%Y-%m-%d}";
        };
        "cpu" = {
          "format" = "{usage}% Ôãõ";
          "tooltip" = false;
        };
        "memory" = {
          "format" = "{}% ÔÉâ";
        };
        "temperature" = {
          # "thermal-zone"= 2;
          # "hwmon-path"= "/sys/class/hwmon/hwmon2/temp1_input";
          "critical-threshold" = 80;
          # "format-critical"= "{temperatureC}¬∞C {icon}";
          "format" = "{temperatureC}¬∞C {icon}";
          "format-icons" = [ "Ôù´" "Ôãâ" "Ôù©" ];
        };
        "backlight" = {
          # "device"= "acpi_video1",
          "format" = "{percent}% {icon}";
          "format-icons" = [ "Óéç" "Óèì" "Óèë" "Óèè" "Óèé" "Óèç" "Óèä" "Óèà" "Óéõ" ];
        };
        "battery" = {
          "states" = {
            # "good"= 95;
            "warning" = 30;
            "critical" = 15;
          };
          "format" = "{capacity}% {icon}";
          "format-charging" = "{capacity}% Ôóß";
          "format-plugged" = "{capacity}% Ôá¶";
          "format-alt" = "{time} {icon}";
          # "format-good"= ""; // An empty format will hide the module
          # "format-full"= "";
          "format-icons" = [ "ÔâÑ" "ÔâÉ" "ÔâÇ" "ÔâÅ" "ÔâÄ" ];
        };
        "battery#bat2" = {
          "bat" = "BAT2";
        };
        "network" = {
          # "interface"= "wlp2*"; // (Optional) To force the use of this interface
          "format-wifi" = "{essid} ({signalStrength}%) Ôá´";
          "format-ethernet" = "{ipaddr}/{cidr} Ôûñ";
          "tooltip-format" = "{ifname} via {gwaddr} Ôûñ";
          "format-linked" = "{ifname} (No IP) Ôûñ";
          "format-disconnected" = "Disconnected ‚ö†";
          "format-alt" = "{ifname}: {ipaddr}/{cidr}";
        };
        "pulseaudio" = {
          # "scroll-step"= 1; // %; can be a float
          "format" = "{volume}% {icon} {format_source}";
          "format-bluetooth" = "{volume}% {icon}Ôäî {format_source}";
          "format-bluetooth-muted" = "&#128263; {icon}Ôäî {format_source}";
          "format-muted" = " &#128263; {format_source}";
          "format-source" = "{volume}% ÔÑ∞";
          "format-source-muted" = "ÔÑ±";
          "format-icons" = {
            "headphone" = "ÔÄ•";
            "hands-free" = "ÔÄ•";
            "headset" = "ÔÄ•";
            "phone" = "ÔÇï";
            "portable" = "ÔÇï";
            "car" = "ÔÜπ";
            "default" = [ "ÔÄ¶" "ÔÄß" "ÔÄ®" ];
          };
          "on-click" = "pavucontrol";
        };
        "bluetooth" = {
          # "controller"= "controller1"; // specify the alias of the controller if there are more than 1 on the system
          "format" = "Ôäî {status}";
          "format-disabled" = ""; # an empty format will hide the module
          "format-connected" = "Ôäî {num_connections} connected";
          "tooltip-format" = "{controller_alias}\t{controller_address}";
          "tooltip-format-connected" = "{controller_alias}\t{controller_address}\n\n{device_enumerate}";
          "tooltip-format-enumerate-connected" = "{device_alias}\t{device_address}";
        };
        "custom/media" =
          let
            waybar-media = pkgs.stdenv.mkDerivation {
              name = "waybar-media";
              unpackPhase = "true";
              installPhase = ''
                mkdir -p $out/bin
                cp ${./scripts/mediaplayer.sh} $out/bin/waybar-media
                chmod +x $out/bin/waybar-media
              '';
            };
          in
          {
            "format" = "{}";
            "return-type" = "json";
            "max-length" = 30;
            "format-icons" = {
              "spotify" = "ÔÜº";
              "default" = "";
            };
            "on-click" = "playerctl play-pause";
            "exec" = "${waybar-media}/bin/waybar-media 2> /dev/null"; # Script in resources folde
          };
      };
    };
  };
}
